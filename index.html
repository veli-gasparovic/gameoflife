<!DOCTYPE html>
<html>
  <head>
    <title>Conway's Game of Life</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </head>
  <body>
    <script>
      const height = window.innerHeight - 20;
      const width = window.innerWidth - 20;
      const cellSize = 40;
      const rows = Math.floor(height / cellSize);
      const cols = Math.floor(width / cellSize);

      const gameBoard = d3
        .select("body")
        .append("svg")
        .attr("width", width)
        .attr("height", height);

      const cells = gameBoard
        .selectAll("rect")
        .data(d3.range(rows * cols))
        .enter()
        .append("rect")
        .attr("width", cellSize)
        .attr("height", cellSize)
        .attr("x", (d) => (d % cols) * cellSize)
        .attr("y", (d) => Math.floor(d / cols) * cellSize)
        .style("fill", "#fff")
        .style("stroke", "#eee");

      let currentState = d3
        .range(rows * cols)
        .map(() => (Math.random() < 0.5 ? 1 : 0));

      const tick = () => {
        const nextState = Array(rows * cols).fill(0);

        for (let row = 0; row < rows; row++) {
          for (let col = 0; col < cols; col++) {
            const idx = col + row * cols;
            const alive = currentState[idx];
            let neighbors = 0;

            for (let i = -1; i <= 1; i++) {
              for (let j = -1; j <= 1; j++) {
                if (i === 0 && j === 0) continue;
                if (
                  row + i >= rows ||
                  col + j >= cols ||
                  row + i < 0 ||
                  col + j < 0
                )
                  continue;
                neighbors += currentState[col + j + (row + i) * cols];
              }
            }

            if (alive) {
              if (neighbors === 2 || neighbors === 3) {
                nextState[idx] = 1;
              } else {
                nextState[idx] = 0;
              }
            } else {
              if (neighbors === 3) {
                nextState[idx] = 1;
              } else {
                nextState[idx] = 0;
              }
            }
          }
        }

        currentState = nextState;

        cells
          .data(currentState)
          .transition()
          .duration(100)
          .style("fill", (d) => (d === 1 ? "#555" : "#fff"));

        setTimeout(tick, 300);
      };

      tick();
    </script>
  </body>
</html>
